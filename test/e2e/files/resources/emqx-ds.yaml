apiVersion: apps.emqx.io/v2beta1
kind: EMQX
metadata:
  name: emqx
spec:
  image: emqx/emqx:latest
  config:
    data: |
      license { key = "evaluation" }
      durable_sessions { enable = true }
      durable_storage { 
        messages {
          backend = builtin_raft
          n_shards = 8
        }
      }
  coreTemplate:
    spec:
      replicas: 2
  replicantTemplate:
    spec:
      replicas: 2
  updateStrategy:
    evacuationStrategy:
      waitTakeover: 1
